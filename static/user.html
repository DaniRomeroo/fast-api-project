<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Panel - Data</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="bg-slate-900 text-slate-200 font-sans min-h-screen">

<!-- Navbar -->
<nav class="bg-slate-800 border-b border-slate-700 shadow-lg">
    <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-user text-emerald-400 text-2xl"></i>
            <h1 class="text-xl font-bold text-white">User Panel</h1>
        </div>
        <div class="flex gap-2">
            <button onclick="goBack()" class="bg-blue-500/20 hover:bg-blue-500/40 text-blue-400 py-2 px-4 rounded">
                Back to Dashboard
            </button>
            <button onclick="logout()" class="bg-red-500/20 hover:bg-red-500/40 text-red-400 py-2 px-4 rounded">
                Logout
            </button>
        </div>
    </div>
</nav>

<main class="max-w-6xl mx-auto px-4 py-10">
<h2 class="text-2xl font-bold mb-6">Available Data</h2>
<table class="w-full text-left border-collapse">
    <thead class="sticky top-0 bg-slate-800">
        <tr class="border-b border-slate-600">
            <th class="py-2 px-4">ID</th>
            <th class="py-2 px-4">Name</th>
            <th class="py-2 px-4">Value</th>
            <th class="py-2 px-4">Date</th>
        </tr>
    </thead>
    <tbody id="dataTable"></tbody>
</table>

<!-- Optional ETL Results (read-only) -->
<section class="mt-10 bg-slate-800 p-6 rounded-lg border border-slate-700 shadow-lg">
    <h2 class="text-xl font-bold mb-4 text-emerald-400">
        <i class="fa-solid fa-database mr-2"></i> ETL Results (Read-Only)
    </h2>

    <button onclick="loadUserData()" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
        Load Data
    </button>

    <pre id="etlOutputUser" class="mt-5 bg-slate-900 p-4 rounded text-sm overflow-x-auto border border-slate-700">
Waiting...
    </pre>
</section>
</main>

<script>
const token = localStorage.getItem('access_token');

async function loadUserData() {
    setUserOutput("Loading data...");
    try {
        const res = await fetch('/users/data', {
            headers: { "Authorization": `Bearer ${token}` }
        });
        if(!res.ok) throw new Error('Failed to fetch data');
        const data = await res.json();

        const tableBody = document.getElementById('dataTable');
        tableBody.innerHTML = '';

        data.forEach(row => {
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-700 hover:bg-slate-700/30";
            tr.innerHTML = `
                <td class="py-2 px-4">${row._id}</td>
                <td class="py-2 px-4">${row.name}</td>
                <td class="py-2 px-4">${row.value}</td>
                <td class="py-2 px-4">${row.date}</td>
            `;
            tableBody.appendChild(tr);
        });

        setUserOutput("Data loaded successfully");
    } catch(err) {
        setUserOutput(err.message);
    }
}

function setUserOutput(text) {
    document.getElementById('etlOutputUser').innerText = text;
}

function goBack(){ window.location.href='/'; }
function logout(){
    localStorage.removeItem('access_token');
    localStorage.removeItem('user_id');
    localStorage.removeItem('role');
    window.location.href='/';
}

loadUserData();
</script>

</body>
</html>
